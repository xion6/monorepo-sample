# ADR-001: ヘキサゴナルアーキテクチャの採用

## ステータス

承認済み

## 文脈

Eコマースプラットフォームの開発において、以下の課題に直面：

### 課題

1. **技術負債の蓄積**: ビジネスロジックとインフラコードの混在
2. **テストの困難性**: 外部システム依存によるユニットテストの複雑化
3. **保守性の低下**: 技術変更時のビジネスロジックへの影響
4. **拡張性の制限**: 新機能追加時の既存コードへの影響範囲拡大

### 要件

- ビジネスロジックの技術独立性
- 高いテスタビリティ
- 外部システム変更への耐性
- チーム開発での保守性

## 決定

**ヘキサゴナルアーキテクチャ（Ports & Adapters）を採用**

### 採用理由

1. **依存性逆転の実現**: ビジネスロジックが技術実装を定義
2. **レイヤー分離**: 明確な責務境界による保守性向上
3. **テスト容易性**: モック・スタブによる独立テスト
4. **技術柔軟性**: アダプター交換による技術スタック変更対応

## 実装詳細

### アーキテクチャ構成

```
Domain (Core) ← Application ← Ports ← Adapters
```

### 技術選択

- **依存性注入**: TSyringe
- **バリデーション**: Zod
- **型安全性**: TypeScript
- **ルール強制**: ESLint no-restricted-imports

### ディレクトリ構造

```
packages/core/src/
├── domain/      # ビジネスロジック
├── port/        # インターフェース定義
├── application/ # ユースケース実装
└── di.ts        # DI設定

apps/web/src/
├── adapters/    # 技術実装
└── lib/         # アプリケーション固有設定
```

## 結果

### 期待される効果

1. **保守性向上**: 変更影響の局所化
2. **開発効率**: 並行開発の可能性
3. **品質向上**: 独立テストによる品質確保
4. **技術柔軟性**: アダプター交換による技術進化対応

### 測定可能な指標

- テストカバレッジ: >90%
- 循環的複雑度: <10
- 依存関係違反: 0件（ESLintによる強制）
- 機能追加時の既存コード変更: <20%

## 代替案

### 1. レイヤードアーキテクチャ

**却下理由**: 下位層への依存による技術縛り

### 2. MVCアーキテクチャ

**却下理由**: ビジネスロジック分散によるテスト困難性

### 3. マイクロサービス

**却下理由**: 初期段階での複雑性過多

## 影響

### 開発チームへの影響

- **学習コスト**: ヘキサゴナルアーキテクチャの理解（1-2週間）
- **初期工数**: アーキテクチャ設計・ESLint設定（3-5日）
- **長期効果**: 保守性向上による開発効率改善

### システムへの影響

- **パフォーマンス**: 抽象化レイヤーによる軽微なオーバーヘッド
- **複雑性**: 初期実装の複雑化、長期保守の単純化
- **拡張性**: 新機能・技術変更への高い対応力

## 関連文書

- [ヘキサゴナルアーキテクチャ設計ガイド](./hexagonal-architecture-guide.md)
- [ESLint設定アーキテクチャ・運用ガイド](./eslint-configuration-history.md)

## 改訂履歴

- 2025-09-28: 初版作成
- 実装完了後: 実績評価と改善点の記録予定
